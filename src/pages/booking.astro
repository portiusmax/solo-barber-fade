---
import BaseLayout from '@/layouts/BaseLayout.astro';
import SectionHeading from '@/components/common/SectionHeading.astro';
import RichText from '@/components/common/RichText.astro';
import { getBookingPage } from '@/lib/keystatic';

const booking = await getBookingPage();

const pageDesc = booking?.pageDescription ? await booking.pageDescription() : null;
const walkInText = booking?.walkInText ? await booking.walkInText() : null;
const cancellation = booking?.cancellationPolicy ? await booking.cancellationPolicy() : null;

const method = booking?.bookingMethod || 'external_link';
const showEmbed = method === 'embed' || method === 'both';
const showLink = method === 'external_link' || method === 'both';
---

<BaseLayout title={`${booking?.pageHeading || 'Book an Appointment'}`}>
  <section class="booking-page section-padding" style="padding-top: 8rem;">
    <div class="container container-narrow">
      <SectionHeading tag="h1">{booking?.pageHeading || 'Book an Appointment'}</SectionHeading>

      {pageDesc && (
        <div class="booking-description reveal">
          <RichText document={pageDesc} />
        </div>
      )}

      <!-- Booking embed -->
      {showEmbed && booking?.embedCode && (
        <div class="booking-embed reveal" set:html={booking.embedCode} />
      )}

      <!-- External booking link -->
      {showLink && booking?.externalBookingUrl && (
        <div class="booking-external reveal">
          <a
            href={booking.externalBookingUrl}
            target="_blank"
            rel="noopener noreferrer"
            class="btn btn-primary booking-btn"
          >
            {booking?.externalBookingButtonText || 'Book Now'}
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6" />
              <polyline points="15 3 21 3 21 9" />
              <line x1="10" y1="14" x2="21" y2="3" />
            </svg>
          </a>
        </div>
      )}

      <!-- Walk-in info -->
      {booking?.showWalkInInfo && walkInText && (
        <div class="booking-walkin reveal">
          <h2 class="subsection-heading">Walk-In Information</h2>
          <RichText document={walkInText} />
        </div>
      )}

      <!-- Cancellation policy -->
      {cancellation && (
        <div class="booking-cancellation reveal">
          <h2 class="subsection-heading">Cancellation Policy</h2>
          <RichText document={cancellation} />
        </div>
      )}
    </div>
  </section>
</BaseLayout>

<style>
  .booking-description {
    text-align: center;
    margin-bottom: 3rem;
    color: var(--color-text-muted);
  }

  .booking-embed {
    margin: 2rem 0 3rem;
    border-radius: var(--radius-lg);
    overflow: hidden;
  }

  .booking-embed :global(iframe) {
    width: 100%;
    min-height: 600px;
    border: none;
    border-radius: var(--radius-lg);
  }

  .booking-external {
    text-align: center;
    margin: 2rem 0 3rem;
  }

  .booking-btn {
    font-size: 1.125rem;
    padding: 1.125rem 3rem;
    gap: 0.625rem;
  }

  .subsection-heading {
    font-size: 1.375rem;
    margin-bottom: 1rem;
    padding-top: 2rem;
    border-top: 1px solid var(--color-border);
    margin-top: 2rem;
  }

  .booking-walkin,
  .booking-cancellation {
    margin-top: 2rem;
  }

  /* Fade theme */
  :global([data-theme="fade"]) .booking-btn:hover {
    box-shadow: 0 0 30px rgba(200, 160, 80, 0.3);
  }
</style>
